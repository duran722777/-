<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>리밸런싱 복리 계산기</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 구글 애드센스 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4634078773523032" crossorigin="anonymous"></script>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0;}
  .container { max-width: 800px; margin:30px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
  h1 { text-align:center; color:#333; }
  label { display:block; margin-top:10px; font-weight:bold; }
  input, select { width: 100%; padding:8px; margin-top:4px; border-radius:5px; border:1px solid #ccc; }
  button { padding:10px 15px; margin-top:15px; border:none; background:#4CAF50; color:#fff; font-size:1em; border-radius:5px; cursor:pointer; }
  table { width:100%; border-collapse: collapse; margin-top:20px;}
  th, td { border:1px solid #ccc; padding:8px; text-align:center; }
  th { background:#eee; }
  .ads { text-align:center; margin:20px 0;}
</style>
</head>
<body>
<div class="container">
<h1>리밸런싱 복리 계산기</h1>

<div class="ads">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-4634078773523032"
       data-ad-slot="8919515384"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<label>기간 단위</label>
<select id="periodType">
  <option value="month">월별</option>
  <option value="year">연별</option>
</select>

<label>초기 투자금 (원)</label>
<input type="number" id="initialInvestment" value="1000000">

<label>매월/연 투자금 (원)</label>
<input type="number" id="periodInvestment" value="0">

<label>수익률</label>
<input type="number" id="interestRate" value="10" step="0.01">
<select id="rateType">
  <option value="year">연평균 %</option>
  <option value="month">월평균 %</option>
</select>

<label>투자 기간</label>
<input type="number" id="totalPeriods" value="12">

<button onclick="calculate()">계산</button>

<h2>총 자산: <span id="totalAssets">0</span> 원</h2>

<canvas id="assetChart" width="700" height="300"></canvas>

<table>
  <thead>
    <tr>
      <th>기간</th>
      <th>총 투자금<br>(Total Invested)</th>
      <th>리밸런싱 전 주식<br>(Stock Before Rebalance)</th>
      <th>리밸런싱 후 주식<br>(Stock After Rebalance)</th>
      <th>현금<br>(Cash)</th>
      <th>총 자산<br>(Total Assets)</th>
      <th>이번기간 수익<br>(Profit This Period)</th>
    </tr>
  </thead>
  <tbody id="resultTable">
  </tbody>
</table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function calculate(){
  const periodType = document.getElementById("periodType").value;
  const initial = parseFloat(document.getElementById("initialInvestment").value);
  const periodInvest = parseFloat(document.getElementById("periodInvestment").value);
  let rate = parseFloat(document.getElementById("interestRate").value)/100;
  const rateType = document.getElementById("rateType").value;
  const totalPeriods = parseInt(document.getElementById("totalPeriods").value);

  if(rateType !== periodType){
    // 연->월 변환
    if(rateType==="year" && periodType==="month"){
      rate = Math.pow(1+rate, 1/12)-1;
    }
    else if(rateType==="month" && periodType==="year"){
      rate = Math.pow(1+rate,12)-1;
    }
  }

  let invested = initial;
  let stock = initial;
  let cash = 0;
  const tableBody = document.getElementById("resultTable");
  tableBody.innerHTML = "";

  const labels = [];
  const totalAssetsArr = [];
  const stockArr = [];
  const cashArr = [];

  for(let i=1;i<=totalPeriods;i++){
    const stockBefore = stock;
    // 이번기간 수익
    const profit = stock * rate;
    stock += profit + periodInvest;
    invested += periodInvest;

    // 단순 리밸런싱 예시: 주식 비율 100%로 가정
    const stockAfter = stock;
    cash = 0;

    const total = stock + cash;

    labels.push(i);
    totalAssetsArr.push(total);
    stockArr.push(stock);
    cashArr.push(cash);

    tableBody.innerHTML += `<tr>
      <td>${i}</td>
      <td>${invested.toLocaleString()}</td>
      <td>${stockBefore.toLocaleString()}</td>
      <td>${stockAfter.toLocaleString()}</td>
      <td>${cash.toLocaleString()}</td>
      <td>${total.toLocaleString()}</td>
      <td>${profit.toLocaleString()}</td>
    </tr>`;
  }

  document.getElementById("totalAssets").innerText = (stock+cash).toLocaleString();

  // 그래프
  const ctx = document.getElementById('assetChart').getContext('2d');
  if(window.myChart) window.myChart.destroy();
  window.myChart = new Chart(ctx, {
    type:'line',
    data:{
      labels:labels,
      datasets:[
        {label:'총 자산', data:totalAssetsArr, borderColor:'blue', fill:false},
        {label:'주식', data:stockArr, borderColor:'green', fill:false},
        {label:'현금', data:cashArr, borderColor:'orange', fill:false}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:'top'}},
      scales:{y:{beginAtZero:true}}
    }
  });
}
</script>
</body>
</html>
